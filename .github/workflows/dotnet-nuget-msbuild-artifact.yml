name: ASP.NET CI

on:
  push:
  # When beranch main is pushed too, run this action
    branches: [ main ]
  pull_request:
  # When a pull request on main is accepted run this action
    branches: [ main ]
    
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build:
    # Uses latest version of windows to build the web application
    runs-on: windows-latest

    # List of steps for the build job
    steps:
    # Checkout master branch
    - uses: actions/checkout@master
    
    # Install MSBuild to build the projecty
    - name: Setup MSBuild.exe
      uses: microsoft/setup-msbuild@v1.1
      
    # Install nuget to restore the nuget packages and restore and dependencies
    - name: Install Nuget
      uses: nuget/setup-nuget@v1
      
    # Run the tree command on current directory so I can see what files are there  
    - name: Directory Tree
      working-directory: ${{env.GITHUB_WORKSPACE}}
      run: tree
      
    # Run the tree command on current directory so I can see what files are there  
    - name: Directory Dir
      working-directory: ${{env.GITHUB_WORKSPACE}}
      run: dir
      
    - name: MSBuild for Release - Build
      working-directory: ${{env.GITHUB_WORKSPACE}}
      run: msbuild "WebApp\DevOpsTest.sln" /t:Rebuild /v:diag /p:Configuration=Release /p:PrecompileBeforePublish=true /p:EnableUpdateable=false
      
    - name: Create Publish Folder
      working-directory: ${{env.GITHUB_WORKSPACE}}\WebApp
      run: tree
      
    - name: MSBuild for Release - Publish
      working-directory: ${{env.GITHUB_WORKSPACE}}
      run: msbuild "WebApp\DevOpsTest.sln" /t:Publish /v:diag /p:Configuration=Release /p:PrecompileBeforePublish=true /p:EnableUpdateable=false /p:OutDir=${{env.GITHUB_WORKSPACE}}\WebApp\Publish
      
      
    # Run the tree command on current directory so I can see what files are there  
    - name: Directory Dir
      working-directory: ${{env.GITHUB_WORKSPACE}}\WebApp\Publish
      run: dir
